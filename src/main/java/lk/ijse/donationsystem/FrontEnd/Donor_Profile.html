<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Donor Profile - LifeSaver</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #d32f2f;
            --secondary-color: #1e88e5;
            --dark-color: #263238;
            --light-color: #f5f5f5;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }

        .navbar {
            background-color: var(--dark-color);
            color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .profile-container {
            max-width: 800px;
            margin: 30px auto;
        }

        .profile-card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .profile-header {
            background: linear-gradient(135deg, var(--primary-color), #b71c1c);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .profile-image {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 15px;
        }

        .profile-body {
            padding: 30px;
        }

        .profile-section {
            margin-bottom: 25px;
        }

        .profile-section h4 {
            color: var(--dark-color);
            border-bottom: 2px solid #eee;
            padding-bottom: 8px;
            margin-bottom: 15px;
        }

        .info-item {
            display: flex;
            margin-bottom: 12px;
        }

        .info-label {
            font-weight: 600;
            min-width: 120px;
            color: var(--dark-color);
        }

        .blood-type {
            display: inline-block;
            padding: 5px 15px;
            background-color: #ffebee;
            color: var(--primary-color);
            border-radius: 20px;
            font-weight: bold;
        }

        .status-active {
            color: #43a047;
            font-weight: 600;
        }

        .status-inactive {
            color: var(--primary-color);
            font-weight: 600;
        }

        .btn-edit {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 5px;
            font-weight: 500;
        }

        .btn-edit:hover {
            background-color: #1976d2;
            color: white;
        }

        .donation-history {
            margin-top: 30px;
        }

        .donation-item {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            border-bottom: 1px solid #eee;
            align-items: center;
        }

        .donation-item:last-child {
            border-bottom: none;
        }

        @media (max-width: 768px) {
            .profile-container {
                margin: 15px;
            }

            .info-item {
                flex-direction: column;
            }

            .info-label {
                margin-bottom: 5px;
            }
        }
    </style>
</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
        <a class="navbar-brand text-white" href="#">
            <i class="fas fa-heartbeat me-2"></i> LifeSaver
        </a>
        <div>
            <button class="btn btn-light me-2" onclick="window.location.href='dashboard.html'">
                <i class="fas fa-home"></i> Dashboard
            </button>
            <button class="btn btn-outline-light" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
    </div>
</nav>

<!-- Profile Content -->
<div class="profile-container">
    <div class="profile-card">
        <div class="profile-header">
            <img id="profileImage" src="https://via.placeholder.com/150" alt="Profile Image" class="profile-image">
            <h2 id="donorName">Loading...</h2>
            <div>
                <span class="blood-type" id="bloodTypeDisplay">-</span>
                <span class="ms-3" id="statusDisplay"></span>
            </div>
        </div>

        <div class="profile-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="profile-section">
                        <h4><i class="fas fa-user-circle me-2"></i>Personal Information</h4>
                        <div class="info-item">
                            <span class="info-label">Email:</span>
                            <span id="donorEmail">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Phone:</span>
                            <span id="donorPhone">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Address:</span>
                            <span id="donorAddress">-</span>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="profile-section">
                        <h4><i class="fas fa-heartbeat me-2"></i>Donation Information</h4>
                        <div class="info-item">
                            <span class="info-label">Status:</span>
                            <span id="donorStatus">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Last Donation:</span>
                            <span id="lastDonation">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Total Donations:</span>
                            <span id="totalDonations">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="text-center mt-4">
                <button class="btn btn-edit" onclick="window.location.href='edit-profile.html'">
                    <i class="fas fa-edit me-2"></i>Edit Profile
                </button>
            </div>

            <div class="text-center mt-4">
                <button class="btn btn-edit" onclick="window.location.href='Donation_Form.html'">
                    <i class="fas fa-edit me-2"></i>Donate Now
                </button>
            </div>

            <div class="donation-history">
                <h4 class="mt-5 mb-4"><i class="fas fa-history me-2"></i>Donation History</h4>
                <div class="card">
                    <div class="card-body p-0">
                        <div id="donationHistory">
                            <div class="donation-item">
                                <span>No donation history available</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const token = localStorage.getItem("authToken");

        if (!token) {
            Swal.fire({
                title: 'Session Expired',
                text: 'Please login again',
                icon: 'warning'
            }).then(() => {
                window.location.href = 'login.html';
            });
            return;
        }

        // Load donor profile
        fetchDonorProfile(token);

        // Logout button
        document.getElementById('logoutBtn').addEventListener('click', function() {
            localStorage.removeItem('authToken');
            window.location.href = 'login.html';
        });
    });

    function fetchDonorProfile(token) {
        fetch("http://localhost:8080/api/v1/donor/profile", {
            method: "GET",
            headers: {
                "Authorization": `Bearer ${token}`
            }
        })
            .then(response => {
                if (!response.ok) throw new Error("Failed to fetch profile");
                return response.json();
            })
            .then(donor => {
                // Update profile information
                document.getElementById('donorName').textContent = donor.name || 'N/A';
                document.getElementById('donorEmail').textContent = donor.email || 'N/A';
                document.getElementById('donorPhone').textContent = donor.phoneNumber || 'N/A';
                document.getElementById('donorAddress').textContent = donor.address || 'N/A';
                document.getElementById('bloodTypeDisplay').textContent = donor.bloodType || '-';

                // Set status with appropriate styling
                const statusElement = document.getElementById('donorStatus');
                statusElement.textContent = donor.status || 'N/A';
                if (donor.status === 'ACTIVE') {
                    statusElement.className = 'status-active';
                } else if (donor.status === 'INACTIVE') {
                    statusElement.className = 'status-inactive';
                }

                // Set profile image
                if (donor.profilePictureUrl) {
                    document.getElementById('profileImage').src =
                        `http://localhost:8080${donor.profilePictureUrl.replace(/\\/g, "/")}`;
                }

                // Load donation history (mock data - replace with actual API call)
                loadDonationHistory(token, donor.email);
            })
            .catch(error => {
                console.error("Error:", error);
                Swal.fire({
                    title: 'Error',
                    text: 'Failed to load donor profile',
                    icon: 'error'
                });
            });
    }

    function loadDonationHistory(token, email) {
        // This is a mock function - replace with actual API call to your backend
        // Example: fetch(`http://localhost:8080/api/v1/donor/${email}/donations`, {...})

        // Mock data
        const mockDonations = [
            { date: '2023-06-15', location: 'Central Blood Bank', units: 1 },
            { date: '2023-03-10', location: 'City Hospital', units: 1 },
            { date: '2022-12-05', location: 'Red Cross Center', units: 1 }
        ];

        const historyContainer = document.getElementById('donationHistory');

        if (mockDonations.length === 0) {
            historyContainer.innerHTML = `
                    <div class="donation-item">
                        <span>No donation history available</span>
                    </div>
                `;
            return;
        }

        let historyHTML = '';
        mockDonations.forEach(donation => {
            historyHTML += `
                    <div class="donation-item">
                        <div>
                            <strong>${donation.date}</strong>
                            <div class="text-muted small">${donation.location}</div>
                        </div>
                        <span class="badge bg-danger">${donation.units} unit(s)</span>
                    </div>
                `;
        });

        historyContainer.innerHTML = historyHTML;
        document.getElementById('totalDonations').textContent = mockDonations.length;
        document.getElementById('lastDonation').textContent = mockDonations[0].date;
    }
</script>
</body>
</html>


<!--
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donor Profile</title>

</head>

<body>

<div class="container">
    <h2>Donor Profile</h2>

    <div id="donorProfileCard"></div>


</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const token = localStorage.getItem("authToken");

        fetch("http://localhost:8080/api/v1/donor/profile", {
            method: "GET",
            headers: {
                "Authorization": `Bearer ${token}`
            }
        })
            .then(res => {
                if (!res.ok) throw new Error("Profile fetch failed");
                return res.json();
            })
            .then(donor => {
                const card = `
                    <div class="card">
                       <img src="http://localhost:8080${donor.profilePictureUrl.replace(/\\/g, "/")}"
    alt="Donor Image"
    style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid #d44;" />
  <h3>${donor.name}</h3>
                        <p>Email: ${donor.email}</p>
                        <p>Phone: ${donor.phoneNumber}</p>
                        <p>Address: ${donor.address}</p>
                        <p>Blood Type: ${donor.bloodType}</p>
                    </div>
                `;
                document.getElementById("donorProfileCard").innerHTML = card;
            })
            .catch(err => {
                console.error("Error:", err);
                alert("Unable to load donor profile.");
            });
    });
</script>

</body>

</html>



-->
